# 分布式架构的常见概念
1. **集群**：多个相同角色共同完成一个任务
2. **分布式**：多个不同角色共同完成一个任务（分布式中有集群，集群不等于分布式）
3. **节点**：独立按照分布式协议完成一组逻辑的程序个体。（在具体的项目中,一个节点表示的是一个操作系统上的进程）
4. **副本机制**：在分布式系统中为数据或服务提供冗余
    1. **数据副本**指在不同的节点上持久化同一份数据,当出现某一个节点的数据丢失时,可以从副本读取数据。++数据副本是分布式系统中防止结果数据丢失的唯一手段++。
    2. **服务副本**表示的是多个节点提供相同的服务,通过主备关系来实现服务的高可用方案。
5.  **中间件**：中间件位于操作系统提供的服务之外,又不属于应用,它是应用和系统层之间为开发者方便的处理通信,输入和输出的一类软件,能够让用户关心自己应用的一部分。

# 架构的发展过程
### 阶段一:单应用架构
系统的初级都是应用和数据库都放在一台服务器上。

![image](http://p9.pstatp.com/large/pgc-image/15271419361693f698c4b3d)

### 阶段二:应用服务器和数据库服务器分离
随着网站的用户量增大，流量增大,对应用服务器和数据库服务器单独的部署机器,这样可以增加系统的性能,提高访问的效率,提高单机的负载能力和容灾的能力。

### 阶段三:应用服务器集群-应用服务器负载告警
随着访问量和流量的增加,假设数据库没有遇到瓶颈,应用服务器集群来对请求进行分流,提高程序的性能。存在的问题:用户的请求由谁来转发,session如何来管理的问题。

![image](http://p3.pstatp.com/large/pgc-image/152714193615572cfb56496)

### 阶段四:数据库压力变大-数据库读写分离
读写分离的话,这样以后的请求，查询的请求就可以去从库里面读数据,写的数据可以到主库中了,但是会带来几个问题:
1. 主从的数据库之间的数据同步:可以使用mysql自带的master-slave方式实现主从复制
2. 对应的数据源的选择:采用第三方数据库中间件,例如:mycat

![image](http://p3.pstatp.com/large/pgc-image/15271419361620e88d464b3)

### 阶段五:使用搜索引擎缓解读库的压力
数据库做读库的话,常常对模糊查询的性能不是很好,特别是对于大型的互联网公司来说,搜索的模块就比较核心了,这是可以使用搜索引擎了,虽然可以大幅度的提高查询的速度,但是同时也会带来一些问题比如索引的构建。

![image](http://p9.pstatp.com/large/pgc-image/1527141936224f9d67be41e)

### 阶段六:引入缓存机制缓解数据库的压力

对一些热点的数据,可以使用redis，memcache来作为应用层的缓存;另外在某些场景下,可以使用mongodb来替代关系型数据库来存储。

### 阶段七:数据库的水平/垂直拆分

垂直拆分:把数据库中不同的业务数据拆分到不同的数据库中。

水平拆分:把同一个表中的数据拆分到两个甚至更多的数据库中,水平拆分的原因是某些业务量数据量大的已经达到了单个数据库的瓶颈,这时候可以采取将表拆分到多个数据库中。

![image](http://p98.pstatp.com/large/pgc-image/152714193654164cf213868)


### 阶段八:应用的拆分

随着业务的发展,业务越来越多,应用的压力越来越大。工程规模也越来越庞大。这个时候就可以考虑将应用拆分,按照领域模型将我们的用户，商品，交易分拆成子系统。

![image](http://p3.pstatp.com/large/pgc-image/152714193649156e6c74e46)

这样拆分以后,可能会有一些相同的代码,比如用户操作,商品的交易查询,所有会导致每个系统都会有用户查询和访问相关的操作。这些相同的代码和模块一定要抽象出来。这样有利于维护和管理。服务拆分以后,服务之间的通信可以通过RPC技术,比较典型的有:webservice、hession、http、RMI等。
![image](http://p1.pstatp.com/large/pgc-image/1527141936549d634abbd24)