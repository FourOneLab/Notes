![image](http://blog.longjiazuo.com/wp-content/uploads/2018/04/TB1phRag79WBuNjSspeXXaz5VXa-600-580.png)

![image](https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTULOWlUaUN0wabI0_mDTq5Wl1b_wzeHH9O-1F0xbfeFyEw1noP)


PAXOS算法，目前公认的解决分布式一致性问题最有效的算法之一，由莱斯利·兰伯特（Leslie Lamport）在1990年提出基于消息传递的一致性算法。

该算法的目的最直接的作用就是解决一个分布式系统如何对一个值的操作（更改、生成、生效等）达成一致。

对分布式算法的研究1980就开始了，通过节点通信保障一致性问题上，存在两种模式：
- 共享内存（Shared memory）
- 消息传递（Messages passing），（PAXOS属于这种模式）。


PAXOS算法：在分布式系统中，存在分布式节点，节点与节点之间通过网络传输数据，终端设备通过网络访问系统。

![image](http://jbcdn2.b0.upaiyun.com/2017/02/8ff084f6b4bf60b82d14e917cff1491f.png)

节点间的通讯数据同步称为消息传递。

由于分布式系统不可避免的故障点原因（**网络延时**、**主机宕机**、**数据传输过程丢失**等），需要一个算法对分布式系统达成共识，在PAXOS（这个算法是基于一个小岛上议会的场景提出）算法中引入三个角色和一些流程号：

- Proposer：提案者（提出某个议案）
- Acceptor：接受者（接受提出者的议案）
- Learners：学习者（学习实施议案）


- 引入节点议案本地编号：PID
- 议案值：value

**三种角色对于节点来说可以复用，前提每个节点执行议案过程中可能出现问题，但是全体的议案值value不会被更改。**

## 算法过程：

1. 分布式节点存在于一个网络环境中，大家网络互通。
2. 每个节点对自己本地的议案有一个数据编号，初始化每个节点PID=0。
3. 节点A提出议案value，作为提案者，接受者接受value。这里有两种情况：
    1. 接受者只有一个的话，那么只要接受者接受了value很快就个议案就成立了，那么要是这个接受者出现网络故障或者本身宕机了，那么就马上执行不下去了。
    2. 那么接受者有多个呢，提案者有多个呢，那么接受者应该怎么接受提案，或者多个接受者接受了不同提案者的value值怎么处理。
    3. **算法中设定，接受者必须接受第一个提案。**
4. 结合PID和value，两个值组合一个数据。
5. 节点A已提出议案value，加上PID，PID一直增加，网络中接受者超过半数接受到节点A的提案，这个节点生效，如果稍后时刻节点B提出议案PID值大于目前PID值，那么通过接受者数量超过半数，该议案生效，如果一开始检测PID小于之前PID就被退回，并告诉节点B。
6. 学习者去收集接受者接收后的提案，且遵循超过半数的原则形成最终的提案，更新value。

### Step-1：提议阶段

节点A选择PID=10，发送10+value的提议请求

接受节点收到10+value，查看本地PID：PID>10,提议被退回。PID<10，先向提议者说明不再接受小于10的提案，查看之前收到过的提案，确定提案把提案中PID最大值发送给节点A。

### Step-2：接受阶段

节点A收到接受节点的回复，逐条处理，如果是接受议案的回复就记录PID。

节点A计算 拒绝和接受的节点个数，如果是拒绝那就准备下一次提案，如果是接受那就选择回复PID中最大值作为自己的提案，如果没有就使用自己提案的PID（这里是10），然后发送给接受节点。

接受节点就相对来说简单，查看自己的PID是否和节点A一致，一致则接受，不一致就拒绝。接下来就发送提案给学习者

学习者在这个阶段保留提案PID，然后根据接受节点接收的数量，如果超过一半就形成共识。